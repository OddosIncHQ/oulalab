<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_catalogo_arriendo" name="Catálogo de Arriendo">
        <t t-call="portal.portal_layout">
            <t t-set="title">Catálogo de Prendas</t>

            <!-- 
                Se añade la clase 'o_rental_catalog' para que el widget de JS se active.
                El atributo 'data-selection-limit' pasa el límite de prendas al script.
            -->
            <div class="o_rental_catalog" t-att-data-selection-limit="prendas_disponibles_para_seleccionar">
                <form action="/my/rentals/request" method="POST">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                    <!-- Barra superior fija para una mejor experiencia de usuario -->
                    <div class="selection-counter-bar text-center sticky-top bg-light py-2 border-bottom">
                        <div class="container">
                            <!-- La clase ahora es 'selection_counter' (con guion bajo) -->
                            <span class="fw-bold selection_counter">0 / <t t-esc="prendas_disponibles_para_seleccionar"/> seleccionadas</span>
                            <button type="submit" class="btn btn-primary ms-3" disabled="1">Solicitar Arriendo</button>
                            <a href="/my/rentals" class="btn btn-secondary ms-2">Cancelar</a>
                        </div>
                    </div>

                    <div class="container mt-4">
                        <div class="row">
                            <t t-if="productos">
                                <t t-foreach="productos" t-as="product">
                                    <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                                        <div class="card h-100 rental-catalog-card">
                                            <img t-attf-src="/web/image/product.product/#{product.id}/image_256" class="card-img-top" alt="Prenda"/>
                                            <div class="card-body text-center d-flex flex-column">
                                                <h5 class="card-title" t-field="product.name"/>
                                                <div class="form-check mt-auto">
                                                    <!-- Se añade la clase 'product-selector-checkbox' -->
                                                    <input class="form-check-input product-selector-checkbox" type="checkbox" name="product_ids" t-att-value="product.id" t-att-id="'product_%s' % product.id"/>
                                                    <label class="form-check-label" t-att-for="'product_%s' % product.id">
                                                        Seleccionar
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </t>
                            <t t-else="">
                                <div class="col-12 text-center">
                                    <div class="alert alert-info" role="alert">
                                        No hay prendas disponibles en este momento. ¡Vuelve a intentarlo más tarde!
                                    </div>
                                </div>
                            </t>
                        </div>
                    </div>
                </form>
            </div>
        </t>
    </template>
</odoo>
