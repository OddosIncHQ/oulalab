<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <record forcecreate="True" id="decimal_payroll" model="decimal.precision">
            <field name="name">Payroll</field>
            <field name="digits">0</field>
        </record>

        <record forcecreate="True" id="decimal_payroll_rate" model="decimal.precision">
            <field name="name">Payroll Rate</field>
            <field name="digits">2</field>
        </record>

        <record id="hr_rule_1" model="hr.salary.rule">
            <field name="name">SUELDO BASE</field>
            <field name="sequence" eval="1"/>
            <field name="code">SUELDO</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
# Validacion Sueldo Empresarial con topes
if (contract.contract_type_id.name == 'Sueldo Empresarial') and (contract.wage >= round(indicadores.tope_imponible_afp * indicadores.uf)):
    result = round(indicadores.tope_imponible_afp * indicadores.uf)
elif (contract.contract_type_id.name == 'Sueldo Empresarial'):
    result = contract.wage
else:
    # Calculo proporcional a dias trabajados (WORK100)
    result = round((contract.wage / 30) * worked_days.WORK100.number_of_days)
            ]]></field>
        </record>

        <record id="hr_rule_2" model="hr.salary.rule">
            <field name="name">AJUSTE LEY SUELDO BASE</field>
            <field name="sequence" eval="2"/>
            <field name="code">ALSB</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = payslip.l10n_cl_indicadores_id.sueldo_minimo > contract.wage</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
result = round(((payslip.l10n_cl_indicadores_id.sueldo_minimo - contract.wage) / 30) * worked_days.WORK100.number_of_days)
            ]]></field>
        </record>

        <record id="hr_rule_3" model="hr.salary.rule">
            <field name="name">OTROS IMPONIBLES</field>
            <field name="sequence" eval="3"/>
            <field name="code">BONO</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = contract.otros_imp > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = ((contract.otros_imp / 30) * worked_days.WORK100.number_of_days)</field>
        </record>

        <record id="hr_rule_4" model="hr.salary.rule">
            <field name="name">HORAS EXTRA ART 32</field>
            <field name="sequence" eval="4"/>
            <field name="code">HEX50</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = inputs.HEX50 and inputs.HEX50.amount > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round(0.00777777 * contract.wage * inputs.HEX50.amount)</field>
        </record>

        <record id="hr_rule_5" model="hr.salary.rule">
            <field name="name">HORAS DESCUENTO</field>
            <field name="sequence" eval="5"/>
            <field name="code">HEXDE</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = inputs.HEXDE and inputs.HEXDE.amount > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round(0.005185 * contract.wage * inputs.HEXDE.amount) * (-1)</field>
        </record>

        <record id="hr_rule_8" model="hr.salary.rule">
            <field name="name">COMISIONES</field>
            <field name="sequence" eval="6"/>
            <field name="code">COMI</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = (inputs.COMI and inputs.COMI.amount > 0)</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.COMI.amount</field>
        </record>

        <record id="hr_rule_7" model="hr.salary.rule">
            <field name="name">BONO DE PRODUCCION</field>
            <field name="sequence" eval="7"/>
            <field name="code">PROD</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = (inputs.PROD and inputs.PROD.amount > 0)</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.PROD.amount</field>
        </record>

        <record id="hr_rule_6" model="hr.salary.rule">
            <field name="name">GRATIFICACION LEGAL (25% CON TOPE)</field>
            <field name="sequence" eval="8"/>
            <field name="code">GRAT</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = (contract.gratificacion_legal is False)</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
# Base: Suma de imponibles anteriores
base_grati = categories.IMPONIBLE 
monto_25 = round(base_grati * 25 / 100)
tope = round(4.75 * indicadores.sueldo_minimo / 12)

if contract.contract_type_id.name == 'Sueldo Empresarial':
    result = 0
elif monto_25 > tope:
    result = tope
else:
    result = monto_25
            ]]></field>
        </record>

        <record id="hr_rule_9" model="hr.salary.rule">
            <field name="name">GRATIFICACION (MANUAL)</field>
            <field name="sequence" eval="9"/>
            <field name="code">GRAT_MAN</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = (contract.gratificacion_legal is True) and (inputs.GRAT and inputs.GRAT.amount > 0)</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.GRAT.amount</field>
        </record>

        <record id="hr_rule_10" model="hr.salary.rule">
            <field name="name">AGUINALDO</field>
            <field name="sequence" eval="10"/>
            <field name="code">AGUI</field>
            <field name="category_id" ref="IMPONIBLE"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = (inputs.AGUI and inputs.AGUI.amount > 0)</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.AGUI.amount</field>
        </record>

        <record id="hr_rule_11" model="hr.salary.rule">
            <field name="name">TOTAL IMPONIBLE</field>
            <field name="sequence" eval="11"/>
            <field name="code">TOTIM</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round(categories.IMPONIBLE)</field>
        </record>

        <record id="hr_rule_12" model="hr.salary.rule">
            <field name="name">ASIGNACION FAMILIAR</field>
            <field name="sequence" eval="12"/>
            <field name="code">ASIGFAM</field>
            <field name="category_id" ref="NOIMPO"/>
            <field name="condition_select">python</field>
            <field name="condition_python"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
# Condiciones: Tener cargas y renta dentro del tramo C
result = ((contract.carga_familiar != 0) or (contract.carga_familiar_maternal != 0) or (contract.carga_familiar_invalida != 0)) and (indicadores.asignacion_familiar_tercer >= contract.wage) and (not contract.pension)
            ]]></field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
dias = 30 if worked_days.WORK100.number_of_days > 25 else worked_days.WORK100.number_of_days
carga = contract.carga_familiar + contract.carga_familiar_maternal + contract.carga_familiar_invalida
imponible = categories.IMPONIBLE

if worked_days.WORK100.number_of_days == 0:
    result = 0
elif indicadores.asignacion_familiar_primer >= imponible:
    result = round(((indicadores.asignacion_familiar_monto_a * carga) / 30) * dias)
elif indicadores.asignacion_familiar_segundo >= imponible:
    result = round(((indicadores.asignacion_familiar_monto_b * carga) / 30) * dias)
elif indicadores.asignacion_familiar_tercer >= imponible:
    result = round(((indicadores.asignacion_familiar_monto_c * carga) / 30) * dias)
else:
    result = 0
            ]]></field>
        </record>

        <record id="hr_rule_13" model="hr.salary.rule">
            <field name="name">COLACION</field>
            <field name="sequence" eval="13"/>
            <field name="code">COL</field>
            <field name="category_id" ref="NOIMPO"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = contract.colacion > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round((contract.colacion / 30) * worked_days.WORK100.number_of_days)</field>
        </record>

        <record id="hr_rule_14" model="hr.salary.rule">
            <field name="name">MOVILIZACION</field>
            <field name="sequence" eval="14"/>
            <field name="code">MOV</field>
            <field name="category_id" ref="NOIMPO"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = contract.movilizacion > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round((contract.movilizacion / 30) * worked_days.WORK100.number_of_days)</field>
        </record>

        <record id="hr_rule_15" model="hr.salary.rule">
            <field name="name">OTROS NO IMPONIBLE</field>
            <field name="sequence" eval="15"/>
            <field name="code">OTRONOIMP</field>
            <field name="category_id" ref="NOIMPO"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = contract.otro_no_imp > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round((contract.otro_no_imp / 30) * worked_days.WORK100.number_of_days)</field>
        </record>

        <record id="hr_rule_16" model="hr.salary.rule">
            <field name="name">VIATICO</field>
            <field name="sequence" eval="16"/>
            <field name="code">VIASAN</field>
            <field name="category_id" ref="NOIMPO"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = contract.viatico_santiago > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round((contract.viatico_santiago / 30) * worked_days.WORK100.number_of_days)</field>
        </record>

        <record id="hr_rule_17" model="hr.salary.rule">
            <field name="name">TOTAL NO IMPONIBLE</field>
            <field name="sequence" eval="17"/>
            <field name="code">TOTNOI</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round(categories.NOIMPO)</field>
        </record>

        <record id="hr_rule_18" model="hr.salary.rule">
            <field name="name">PREVISION (AFP)</field>
            <field name="sequence" eval="18"/>
            <field name="code">PREV</field>
            <field name="category_id" ref="PREV"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
# Nota: contract.afp_id.rate tiene la tasa configurada en el contrato/maestro
tasa = contract.afp_id.rate

# Topes
tope_pesos = round(indicadores.tope_imponible_afp * indicadores.uf)
base_calculo = TOTIM if TOTIM < tope_pesos else tope_pesos

if contract.pension or contract.sin_afp:
    result = 0
else:
    result = round(base_calculo * tasa / 100)
            ]]></field>
        </record>

        <record id="hr_rule_19" model="hr.salary.rule">
            <field name="name">SEGURO CESANTIA (Trabajador)</field>
            <field name="sequence" eval="19"/>
            <field name="code">SECE</field>
            <field name="category_id" ref="PREV"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
tope_sc = round(indicadores.tope_imponible_seguro_cesantia * indicadores.uf)
base_calculo = TOTIM if TOTIM < tope_sc else tope_sc

if contract.pension or contract.contract_type_id.name in ['Sueldo Empresarial', 'Plazo Fijo']:
    result = 0
elif contract.contract_type_id.name == 'Plazo Indefinido':
    result = round(base_calculo * indicadores.contrato_plazo_indefinido_trabajador / 100)
elif contract.contract_type_id.name == 'Indefinido 11 anos o mas':
    result = round(base_calculo * indicadores.contrato_plazo_indefinido_trabajador / 100) # Asumimos misma tasa
else:
    result = 0
            ]]></field>
        </record>

        <record id="hr_rule_20" model="hr.salary.rule">
            <field name="name">APORTE AL AHORRO VOLUNTARIO (APV)</field>
            <field name="sequence" eval="20"/>
            <field name="code">APV</field>
            <field name="category_id" ref="PREV"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = contract.aporte_voluntario > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
tasa = indicadores.uf if contract.aporte_voluntario_moneda == 'uf' else 1
monto_apv = round(contract.aporte_voluntario * tasa)
tope_mensual = round(indicadores.tope_mensual_apv * indicadores.uf)

result = tope_mensual if monto_apv > tope_mensual else monto_apv
            ]]></field>
        </record>

        <record id="hr_rule_21" model="hr.salary.rule">
            <field name="name">SEGURO CESANTIA (Aporte Empresa)</field>
            <field name="sequence" eval="21"/>
            <field name="code">SECEEMP</field>
            <field name="category_id" ref="COMP"/>
            <field name="appears_on_payslip" eval="False"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
tope_sc = round(indicadores.tope_imponible_seguro_cesantia * indicadores.uf)
# Recalculo de base incluyendo gratificacion para tope si TOTIM es 0 o menor
base_calculo = TOTIM if TOTIM > 0 else (categories.IMPONIBLE) 
if base_calculo > tope_sc:
    base_calculo = tope_sc

if contract.pension or contract.contract_type_id.name == 'Sueldo Empresarial':
    result = 0
elif contract.contract_type_id.name == 'Plazo Indefinido':
    result = round(base_calculo * indicadores.contrato_plazo_indefinido_empleador / 100)
elif contract.contract_type_id.name == 'Plazo Fijo':
    result = round(base_calculo * indicadores.contrato_plazo_fijo_empleador / 100)
else:
    result = 0
            ]]></field>
        </record>

        <record id="hr_rule_22" model="hr.salary.rule">
            <field name="name">SIS (Aporte Empresa)</field>
            <field name="sequence" eval="22"/>
            <field name="code">SIS</field>
            <field name="category_id" ref="COMP"/>
            <field name="appears_on_payslip" eval="False"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
tasa_sis = contract.afp_id.sis # Usamos la tasa del maestro de AFP

tope_afp = round(indicadores.tope_imponible_afp * indicadores.uf)
base_calculo = TOTIM if TOTIM < tope_afp else tope_afp

if contract.pension or contract.sin_afp_sis:
    result = 0
else:
    result = round(base_calculo * tasa_sis / 100)
            ]]></field>
        </record>

        <record id="hr_rule_23" model="hr.salary.rule">
            <field name="name">MUTUAL SEGURIDAD (Empresa)</field>
            <field name="sequence" eval="23"/>
            <field name="code">MUT</field>
            <field name="category_id" ref="COMP"/>
            <field name="appears_on_payslip" eval="False"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
tope_afp = round(indicadores.tope_imponible_afp * indicadores.uf)
base_calculo = TOTIM if TOTIM < tope_afp else tope_afp

if contract.contract_type_id.name == 'Sueldo Empresarial':
    result = 0
else:
    # mutual_seguridad en indicadores es la tasa general o especifica de la empresa
    result = round(base_calculo * indicadores.mutual_seguridad / 100)
            ]]></field>
            </record>

        <record id="hr_rule_24" model="hr.salary.rule">
            <field name="name">SEGURO COMPLEMENTARIO</field>
            <field name="sequence" eval="24"/>
            <field name="code">SECOMP</field>
            <field name="category_id" ref="COMP"/>
            <field name="condition_select">python</field>
            <field name="appears_on_payslip" eval="False"/>
            <field name="condition_python">result = contract.seguro_complementario > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
tasa = payslip.l10n_cl_indicadores_id.uf if contract.seguro_complementario_moneda == 'uf' else 1
result = round(contract.seguro_complementario * tasa)
            ]]></field>
        </record>

        <record id="hr_rule_25" model="hr.salary.rule">
            <field name="name">AFP X PAGAR</field>
            <field name="sequence" eval="25"/>
            <field name="code">AFP_PAGAR</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">none</field>
            <field name="appears_on_payslip" eval="False"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = categories.PREV + SIS + SECEEMP</field>
            </record>

        <record id="hr_rule_26" model="hr.salary.rule">
            <field name="name">SALUD (7%)</field>
            <field name="sequence" eval="26"/>
            <field name="code">SALUD</field>
            <field name="category_id" ref="SALUD"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
# 7% Obligatorio
cotizacion_7 = round(TOTIM * 7 / 100)

# Tope Legal Salud (en UF)
tope_legal = round(indicadores.tope_imponible_salud * indicadores.tope_imponible_afp / 100 * indicadores.uf)

if contract.isapre_cuenta_propia:
    result = 0
elif cotizacion_7 > tope_legal:
    result = tope_legal
else:
    result = cotizacion_7
            ]]></field>
        </record>

        <record id="hr_rule_27" model="hr.salary.rule">
            <field name="name">ADICIONAL ISAPRE</field>
            <field name="sequence" eval="27"/>
            <field name="code">ADISA</field>
            <field name="category_id" ref="SALUD"/>
            <field name="condition_select">python</field>
            <field name="condition_python"><![CDATA[
result = (contract.isapre_id.name != 'FONASA') and (not contract.isapre_cuenta_propia) and (worked_days.WORK100.number_of_days > 0)
            ]]></field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
# Valor pactado en UF convertido a pesos, proporcional a dias trabajados
pactado = round((indicadores.uf / 30 * worked_days.WORK100.number_of_days) * contract.isapre_cotizacion_uf)
if pactado > SALUD:
    result = pactado - SALUD
else:
    result = 0
            ]]></field>
        </record>

        <record id="hr_rule_33" model="hr.salary.rule">
            <field name="name">CAJA DE COMPENSACION (0.6%)</field>
            <field name="sequence" eval="33"/>
            <field name="code">CAJACOMP</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = contract.isapre_id.name == 'FONASA'</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
# Si es Fonasa, el 7% se divide: 0.6% a Caja y 6.4% a Fonasa
# Si llega al tope, se calcula sobre el tope
tope_legal = round(indicadores.tope_imponible_salud * indicadores.tope_imponible_afp / 100 * indicadores.uf)
cotizacion_7 = round(TOTIM * 7 / 100)

base_calculo = tope_legal if cotizacion_7 > tope_legal else cotizacion_7

# Regla de 3 simple: 0.6 es la parte de CCAF dentro del 7%
result = round(base_calculo * indicadores.caja_compensacion / 7)
            ]]></field>
        </record>

        <record id="hr_rule_34" model="hr.salary.rule">
            <field name="name">FONASA (6.4%)</field>
            <field name="sequence" eval="34"/>
            <field name="code">FONASA</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = contract.isapre_id.name == 'FONASA'</field>
            <field name="amount_select">code</field>
            <field name="appears_on_payslip" eval="False"/>
            <field name="amount_python_compute"><![CDATA[
# Es el resto del 7% (SALUD - CAJACOMP)
result = SALUD - CAJACOMP
            ]]></field>
        </record>

        <record id="hr_rule_35" model="hr.salary.rule">
            <field name="name">TRIBUTABLE</field>
            <field name="sequence" eval="35"/>
            <field name="code">TRIBU</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
# Tope descuento salud para efectos tributarios
tope_salud_trib = round(indicadores.uf * (indicadores.tope_imponible_salud * indicadores.tope_imponible_afp / 100))
desc_salud = categories.SALUD

if desc_salud > tope_salud_trib:
    desc_salud = tope_salud_trib

result = TOTIM - desc_salud - categories.PREV - SECE
if result < 0:
    result = 0
            ]]></field>
        </record>

        <record id="hr_rule_36" model="hr.salary.rule">
            <field name="name">IMPUESTO UNICO</field>
            <field name="sequence" eval="36"/>
            <field name="code">IMPUNI</field>
            <field name="category_id" ref="DED"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = TRIBU > (payslip.l10n_cl_indicadores_id.utm * 13.5)</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
utm = indicadores.utm
base = TRIBU

# Tabla Impuesto (Factores UTM)
if base <= (utm * 13.5):
    result = 0
elif base <= (utm * 30):
    result = (base * 0.04) - (utm * 0.54)
elif base <= (utm * 50):
    result = (base * 0.08) - (utm * 1.74)
elif base <= (utm * 70):
    result = (base * 0.135) - (utm * 4.49)
elif base <= (utm * 90):
    result = (base * 0.23) - (utm * 11.14)
elif base <= (utm * 120):
    result = (base * 0.304) - (utm * 17.80)
elif base <= (utm * 150):
    result = (base * 0.355) - (utm * 23.92)
else:
    result = (base * 0.40) - (utm * 30.67)

result = round(result)
            ]]></field>
            </record>

        <record id="hr_rule_37" model="hr.salary.rule">
            <field name="name">TOTAL DESC. LEGALES</field>
            <field name="sequence" eval="37"/>
            <field name="code">TODELE</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round(categories.PREV) + round(categories.SALUD) + round(categories.DED)</field>
        </record>

        <record id="hr_rule_38" model="hr.salary.rule">
            <field name="name">ANTICIPO DE SUELDO</field>
            <field name="sequence" eval="38"/>
            <field name="code">ASUE</field>
            <field name="category_id" ref="ODESC"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = (contract.anticipo_sueldo > 0) or (inputs.ASUE and inputs.ASUE.amount > 0)</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
if (inputs.ASUE and inputs.ASUE.amount > 0):
    result = inputs.ASUE.amount
else:
    result = contract.anticipo_sueldo
            ]]></field>
        </record>

        <record id="hr_rule_38_1" model="hr.salary.rule">
            <field name="name">PRESTAMOS EMPRESA</field>
            <field name="sequence" eval="38"/>
            <field name="code">PREST</field>
            <field name="category_id" ref="ODESC"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = inputs.PREST and inputs.PREST.amount > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.PREST.amount</field>
        </record>

        <record id="hr_rule_38_2" model="hr.salary.rule">
            <field name="name">PRESTAMOS CCAF</field>
            <field name="sequence" eval="38"/>
            <field name="code">PCCAF</field>
            <field name="category_id" ref="ODESC"/>
            <field name="condition_select">python</field>
            <field name="condition_python">result = inputs.PCCAF and inputs.PCCAF.amount > 0</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.PCCAF.amount</field>
        </record>

        <record id="hr_rule_39" model="hr.salary.rule">
            <field name="name">OTROS DESCUENTOS</field>
            <field name="sequence" eval="39"/>
            <field name="code">TOD</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = categories.ODESC</field>
        </record>

        <record id="hr_rule_41" model="hr.salary.rule">
            <field name="name">TOTAL DESCUENTOS</field>
            <field name="sequence" eval="41"/>
            <field name="code">TDE</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = round(TODELE) + round(TOD)</field>
        </record>

        <record id="hr_rule_42" model="hr.salary.rule">
            <field name="name">TOTAL HABERES</field>
            <field name="sequence" eval="42"/>
            <field name="code">HAB</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = categories.IMPONIBLE + categories.NOIMPO</field>
        </record>

        <record id="hr_rule_44" model="hr.salary.rule">
            <field name="name">ALCANCE LIQUIDO</field>
            <field name="sequence" eval="44"/>
            <field name="code">LIQ</field>
            <field name="category_id" ref="SUBT"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="active">True</field>
            <field name="amount_python_compute">result = HAB - TDE</field>
        </record>

        <record id="hr_rule_45" model="hr.salary.rule">
            <field name="name">COTIZACION ACC. TRABAJO ISL</field>
            <field name="sequence" eval="23"/>
            <field name="code">ISL</field>
            <field name="category_id" ref="COMP"/>
            <field name="appears_on_payslip" eval="False"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
indicadores = payslip.l10n_cl_indicadores_id
tope_afp = round(indicadores.tope_imponible_afp * indicadores.uf)
base_calculo = TOTIM if TOTIM < tope_afp else tope_afp

# Si NO tiene mutual privada, paga ISL
if indicadores.mutual_seguridad_bool or contract.contract_type_id.name == 'Sueldo Empresarial':
    result = 0
else:
    result = round(base_calculo * indicadores.isl / 100)
            ]]></field>
            </record>


        <record id="hr_rule_input_horas_ext_50" model="hr.rule.input">
            <field name="code">HEX50</field>
            <field name="name">HORAS EXTRA ART 32</field>
            <field name="input_id" ref="hr_rule_4"/>
        </record>

        <record id="hr_rule_input_horas_ext_de" model="hr.rule.input">
            <field name="code">HEXDE</field>
            <field name="name">HORAS DESCUENTO</field>
            <field name="input_id" ref="hr_rule_5"/>
        </record>

        <record id="hr_rule_input_bono_produccion" model="hr.rule.input">
            <field name="code">PROD</field>
            <field name="name">BONO DE PRODUCCION</field>
            <field name="input_id" ref="hr_rule_7"/>
        </record>

        <record id="hr_rule_input_comisiones" model="hr.rule.input">
            <field name="code">COMI</field>
            <field name="name">COMISIONES</field>
            <field name="input_id" ref="hr_rule_8"/>
        </record>

        <record id="hr_rule_input_gratificacion_legal" model="hr.rule.input">
            <field name="code">GRAT</field>
            <field name="name">GRATIFICACION MANUAL</field>
            <field name="input_id" ref="hr_rule_9"/>
        </record>

        <record id="hr_rule_input_aguinaldo" model="hr.rule.input">
            <field name="code">AGUI</field>
            <field name="name">AGUINALDO</field>
            <field name="input_id" ref="hr_rule_10"/>
        </record>

        <record id="hr_rule_input_prestamos" model="hr.rule.input">
            <field name="code">PREST</field>
            <field name="name">PRESTAMO EMPRESA</field>
            <field name="input_id" ref="hr_rule_38_1"/> </record>

        <record id="hr_rule_input_prestamos_ccaf" model="hr.rule.input">
            <field name="code">PCCAF</field>
            <field name="name">PRESTAMO CCAF</field>
            <field name="input_id" ref="hr_rule_38_2"/> </record>

        <record id="hr_rule_input_anticipo_sueldo" model="hr.rule.input">
            <field name="code">ASUE</field>
            <field name="name">ANTICIPO DE SUELDO</field>
            <field name="input_id" ref="hr_rule_38"/>
        </record>

        <record id="hr_struct_cl" model="hr.payroll.structure">
            <field name="name">CÃ³digo del Trabajo (Chile)</field>
            <field name="code">CL_BASE</field> <field name="type_id" ref="hr_contract.structure_type_employee"/> <field name="rule_ids" eval="[(6, 0, [
                ref('hr_rule_1'), ref('hr_rule_2'), ref('hr_rule_3'), ref('hr_rule_4'),
                ref('hr_rule_5'), ref('hr_rule_6'), ref('hr_rule_7'), ref('hr_rule_8'),
                ref('hr_rule_9'), ref('hr_rule_10'), ref('hr_rule_11'), ref('hr_rule_12'),
                ref('hr_rule_13'), ref('hr_rule_14'), ref('hr_rule_15'), ref('hr_rule_16'),
                ref('hr_rule_17'), ref('hr_rule_18'), ref('hr_rule_19'), ref('hr_rule_20'),
                ref('hr_rule_21'), ref('hr_rule_22'), ref('hr_rule_23'), ref('hr_rule_24'),
                ref('hr_rule_25'), ref('hr_rule_26'), ref('hr_rule_27'), ref('hr_rule_28'),
                ref('hr_rule_33'), ref('hr_rule_34'), ref('hr_rule_35'), ref('hr_rule_36'),
                ref('hr_rule_37'), ref('hr_rule_38'), ref('hr_rule_38_1'), ref('hr_rule_38_2'),
                ref('hr_rule_39'), ref('hr_rule_41'), ref('hr_rule_42'),
                ref('hr_rule_44'), ref('hr_rule_45')
            ])]"/>
        </record>

    </data>
</odoo>
