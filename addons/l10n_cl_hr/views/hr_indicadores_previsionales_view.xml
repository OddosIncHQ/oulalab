<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_hr_indicadores_tree" model="ir.ui.view">
        <field name="name">hr.indicadores.tree</field>
        <field name="model">hr.indicadores</field>
        <field name="arch" type="xml">
            <list string="Indicadores Previsionales" decoration-info="state == 'draft'">
                <field name="name"/>
                <field name="uf"/>
                <field name="utm"/>
                <field name="month"/>
                <field name="year"/>
                <field name="state" widget="badge" decoration-success="state == 'done'" decoration-info="state == 'draft'"/>
            </list>
        </field>
    </record>

    <record id="view_hr_indicadores_form" model="ir.ui.view">
        <field name="name">hr.indicadores.view</field>
        <field name="model">hr.indicadores</field>
        <field name="arch" type="xml">
            <form string="Indicadores Previsionales">
                <header>
                    <button string="Validar" type="object" name="action_done" 
                            class="oe_highlight" 
                            invisible="state != 'draft'"
                            groups="hr_payroll.group_hr_payroll_user"/>
                            
                    <button string="Volver a borrador" type="object" name="action_draft" 
                            invisible="state == 'draft'"
                            groups="hr_payroll.group_hr_payroll_manager"/>
                            
                    <button string="Actualizar desde Previred" type="object" name="update_document"
                            context="{'force_update':True}" 
                            invisible="state != 'draft'"
                            class="btn-secondary"/>
                            
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" icon="fa-globe">
                            <div class="o_field_widget o_readonly_modifier o_required_modifier">
                                <a href="https://www.previred.com/web/previred/indicadores-previsionales" 
                                   target="_blank" style="font-weight:bold;">
                                   Ir a Previred
                                </a>
                            </div>
                        </button>
                    </div>

                    <div class="oe_title">
                        <h1><field name="name" placeholder="Ej: Enero 2025"/></h1>
                    </div>

                    <group>
                        <group string="Periodo">
                            <field name="month"/>
                            <field name="year"/>
                        </group>
                        <group string="Valores Base">
                            <field name="uf"/>
                            <field name="utm"/>
                            <field name="uta"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Tasas y Cotizaciones" name="previred">
                            <group string="Tasa Cotización Obligatorio AFP">
                                <group>
                                    <field name="tasa_afp_capital"/>
                                    <field name="tasa_afp_cuprum"/>
                                    <field name="tasa_afp_habitat"/>
                                    <field name="tasa_afp_planvital"/>
                                    <field name="tasa_afp_provida"/>
                                    <field name="tasa_afp_modelo"/>
                                    <field name="tasa_afp_uno"/>
                                </group>
                                <group>
                                    <field name="tasa_sis_capital" string="SIS Capital"/>
                                    <field name="tasa_sis_cuprum" string="SIS Cuprum"/>
                                    <field name="tasa_sis_habitat" string="SIS Habitat"/>
                                    <field name="tasa_sis_planvital" string="SIS PlanVital"/>
                                    <field name="tasa_sis_provida" string="SIS Provida"/>
                                    <field name="tasa_sis_modelo" string="SIS Modelo"/>
                                    <field name="tasa_sis_uno" string="SIS Uno"/>
                                </group>
                            </group>

                            <group>
                                <group string="Rentas Topes Imponibles">
                                    <field name="tope_imponible_afp"/>
                                    <field name="tope_imponible_ips"/>
                                    <field name="tope_imponible_seguro_cesantia"/>
                                </group>
                                <group string="Rentas Mínimas">
                                    <field name="sueldo_minimo"/>
                                    <field name="sueldo_minimo_otro"/>
                                </group>
                            </group>

                            <group string="Asignación Familiar">
                                <group>
                                    <field name="asignacion_familiar_monto_a"/>
                                    <field name="asignacion_familiar_monto_b"/>
                                    <field name="asignacion_familiar_monto_c"/>
                                </group>
                                <group>
                                    <field name="asignacion_familiar_primer" string="Tope Tramo A"/>
                                    <field name="asignacion_familiar_segundo" string="Tope Tramo B"/>
                                    <field name="asignacion_familiar_tercer" string="Tope Tramo C"/>
                                </group>
                            </group>

                            <group>
                                <group string="Ahorro Previsional Voluntario (APV)">
                                    <field name="tope_anual_apv"/>
                                    <field name="tope_mensual_apv"/>
                                    <field name="deposito_convenido"/>
                                </group>
                                <group string="Seguro de Cesantía (AFC)">
                                    <field name="contrato_plazo_fijo_empleador"/>
                                    <field name="contrato_plazo_indefinido_empleador"/>
                                    <field name="contrato_plazo_indefinido_trabajador"/>
                                    <field name="contrato_plazo_indefinido_empleador_otro" string="Indefinido 11 años+"/>
                                </group>
                            </group>
                        </page>

                        <page string="Instituciones y Factores">
                            <group>
                                <group string="Salud y Pensiones">
                                    <field name="fonasa" string="Tasa Fonasa"/>
                                    <field name="pensiones_ips"/>
                                    <field name="tope_imponible_salud"/>
                                    <field name="ccaf_id"/>
                                    <field name="caja_compensacion" string="Tasa CCAF"/>
                                </group>
                                <group string="Mutualidad (Seguridad Laboral)">
                                    <field name="mutual_seguridad_bool"/>
                                    
                                    <field name="mutualidad_id" invisible="not mutual_seguridad_bool"/>
                                    <field name="mutual_seguridad" invisible="not mutual_seguridad_bool"/>
                                    <field name="isl" invisible="mutual_seguridad_bool"/>
                                </group>
                            </group>
                            <group string="Estadísticas">
                                <field name="ipc"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_hr_indicadores_previsionales" model="ir.actions.act_window">
        <field name="name">Indicadores Previsionales</field>
        <field name="res_model">hr.indicadores</field>
        <field name="view_mode">list,form</field>
    </record>

    <menuitem id="menu_hr_indicadores_previsionales"
        parent="menu_cl_hr_payroll_configuration"
        action="action_hr_indicadores_previsionales" 
        sequence="10"/>

    <record id="action_hr_isapre" model="ir.actions.act_window">
        <field name="name">Instituciones de Salud (Isapre)</field>
        <field name="res_model">hr.isapre</field>
        <field name="view_mode">list,form</field>
    </record>

    <menuitem id="menu_hr_isapre"
        parent="menu_cl_hr_payroll_configuration" 
        action="action_hr_isapre"
        sequence="11"/>

    <record id="action_hr_ccaf" model="ir.actions.act_window">
        <field name="name">Cajas de Compensación (CCAF)</field>
        <field name="res_model">hr.ccaf</field>
        <field name="view_mode">list,form</field>
    </record>

    <menuitem id="menu_hr_ccaf"
        parent="menu_cl_hr_payroll_configuration" 
        action="action_hr_ccaf"
        sequence="12"/>

    <record id="action_hr_mutual" model="ir.actions.act_window">
        <field name="name">Mutualidades</field>
        <field name="res_model">hr.mutual</field>
        <field name="view_mode">list,form</field>
    </record>

    <menuitem id="menu_hr_mutual"
        parent="menu_cl_hr_payroll_configuration" 
        action="action_hr_mutual"
        sequence="13"/>

    <record id="action_hr_apv" model="ir.actions.act_window">
        <field name="name">Instituciones APV</field>
        <field name="res_model">hr.apv</field>
        <field name="view_mode">list,form</field>
    </record>

    <menuitem id="menu_hr_apv"
        parent="menu_cl_hr_payroll_configuration" 
        action="action_hr_apv"
        sequence="14"/>

</odoo>
